services:
  user-management-service:
    build:
      context: .
      dockerfile: services/user_management/dockerfile
    image: saferoute/user_management:latest
    container_name: saferoute-user-management
    platform: linux/amd64
    ports:
      - "20000:80"
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=80
    restart: unless-stopped

  notification-service:
    build:
      context: .
      dockerfile: services/notification/dockerfile
    image: saferoute/notification:latest
    container_name: saferoute-notification
    platform: linux/amd64
    ports:
      - "20001:80"
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=80
    restart: unless-stopped

  routing-service:
    build:
      context: .
      dockerfile: services/routing_service/dockerfile
    image: saferoute/routing-service:latest
    container_name: saferoute-routing-service
    platform: linux/amd64
    ports:
      - "20002:80"
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=80
    restart: unless-stopped

  safety-scoring-service:
    build:
      context: .
      dockerfile: services/safety_scoring/dockerfile
    image: saferoute/safety_scoring:latest
    container_name: saferoute-safety-scoring
    platform: linux/amd64
    ports:
      - "20003:80"
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=80
      - POSTGIS_HOST=postgis
      - POSTGIS_PORT=5432
      - POSTGIS_USER=saferoute
      - POSTGIS_PASSWORD=Owen1SL8te
      - POSTGIS_DATABASE=saferoute_geo
      - GRAPHHOPPER_PROXY_SERVICE_URL=http://graphhopper-proxy-service:80
    depends_on:
      - postgis
      - graphhopper-proxy-service
    restart: unless-stopped

  graphhopper-proxy-service:
    build:
      context: .
      dockerfile: services/graphhopper_proxy/dockerfile
    image: saferoute/graphhopper-proxy:latest
    container_name: saferoute-graphhopper-proxy
    platform: linux/amd64
    ports:
      - "20007:80"
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=80
      - GRAPHHOPPER_BASE_URL=http://host.docker.internal:8989
      - GRAPHHOPPER_PROFILE=foot
    restart: unless-stopped

  feedback-service:
    build:
      context: .
      dockerfile: services/feedback/dockerfile
    image: saferoute/feedback:latest
    container_name: saferoute-feedback
    platform: linux/amd64
    ports:
      - "20004:80"
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=80
    restart: unless-stopped

  sos-service:
    build:
      context: .
      dockerfile: services/sos/dockerfile
    image: saferoute/sos:latest
    container_name: saferoute-sos
    platform: linux/amd64
    ports:
      - "20006:80"
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=80
    restart: unless-stopped

  postgis:
    image: postgis/postgis:15-3.3
    container_name: saferoute-postgis
    platform: linux/amd64
    restart: unless-stopped
    environment:
      - POSTGRES_USER=saferoute
      - POSTGRES_PASSWORD=Owen1SL8te
      - POSTGRES_DB=saferoute_geo
    volumes:
      - postgis_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"

volumes:
  postgis_data:
